<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/css/appointment.css">

    <title>appointment</title>
</head>
<body>
    <style>
        body{
         background-image: url("/css/images/homebg.png");
         background-size: 100% 100%;
         background-attachment: fixed;
         background-repeat: no-repeat;
        }
    </style> 
    <div class="sidebar">
        <img src="/css/images/profile6.png" alt="Profile Photo">
        <h3>{{username}}</h3>
        <ul>
  <li onclick="window.location.href='/patientview/{{userId}}'">
    <a>My Appointments</a>
  </li>
  <li onclick="window.location.href='/search'">
    <a>Search</a>
  </li>
  <li onclick="window.location.href='/'">
    <a>Home</a>
  </li>
  <li onclick="window.location.href='/about'">
    <a>About</a>
  </li>
  <li onclick="window.location.href='/contact'">
    <a>Contact</a>
  </li>
</ul>
    </div>
    <div class="card">
  <img src="/css/images/profile2.png" class="profile">
  <div class="info">
    <h2>DR.{{doctor.name}}</h2>
    <h3>{{doctor.specialization}}</h3>
    <h3>{{doctor.location}}</h3>
    <button class="pill-button" onclick="redirectToLocation()">
  <i class="fas fa-map-marker-alt"></i>
  View Location
</button>
    <h3>{{doctor.time}}</h3>
    <div class="picker">
      Select date
      <input type="date" id="date-picker">
    </div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
   <form id="appointmentForm" enctype="multipart/form-data">
 <div class="file-upload">
  <label for="file">Upload Document:</label>
  <input type="file" id="file" name="document" accept=".pdf, .jpg, .jpeg, .png">
</div>
  <button class="button" type="submit">Book Appointment</button>
</form>
  </div>
</div>
<script>
  const fileInput = document.getElementById('file');
  
  fileInput.addEventListener('change', (event) => {
    const selectedFile = event.target.files[0];
    
    if (selectedFile) {
      const fileType = selectedFile.type;
      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
      
      if (!allowedTypes.includes(fileType)) {
        alert('Only PDF or image files are allowed.');
        fileInput.value = ''; // Clear the file input
      }
    }
  });
  function redirectToLocation() {
  window.location.href = "{{doctor.mapLink}}"; // Replace with your desired link
}
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const appointmentForm = document.getElementById('appointmentForm');
    const fileInput = document.getElementById('file');

    appointmentForm.addEventListener('submit', (event) => {
      event.preventDefault(); // Prevent the form from submitting

      const formData = new FormData();
      formData.append('document', fileInput.files[0]);

      const datePicker = document.getElementById('date-picker');
      const selectedDate = new Date(datePicker.value);
      const today = new Date();

      if (selectedDate < today) {
        alert("Selected date is before today's date. Please choose a future date.");
        return;
      }

      const patient_Id = "{{userId}}";
      const patientName = "{{username}}";
      const doctorName = "{{doctor.name}}";
      const doctorLocation = "{{doctor.location}}";
      const consultationTime = "{{doctor.time}}";
      const doctorSpecialization = "{{doctor.specialization}}";

      formData.append('datePicker', datePicker.value);
      formData.append('patient_Id', patient_Id);
      formData.append('patientName', patientName);
      formData.append('doctorName', doctorName);
      formData.append('doctorLocation', doctorLocation);
      formData.append('consultationTime', consultationTime);
      formData.append('doctorSpecialization', doctorSpecialization);

      fetch('/appointment', {
        method: 'POST',
        body: formData
      })
        .then(response => {
          if (response.ok) {
            // Show a success message to the user
            response.text().then(msg => {
              alert(msg);
            });
          } else {
            // Show an error message to the user
            alert('Failed to book appointment!');
          }
        })
        .catch(error => {
          // Show an error message to the user
          alert('Failed to book appointment!');
        });
    });
  });
</script>


   
</body>
</html>
